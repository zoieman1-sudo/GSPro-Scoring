{% extends "kiosk_base.html" %}

{% macro format_net(value) -%}
  {%- if value is none -%}
    —
  {%- elif value == value|int -%}
    {{ value|int }}
  {%- else -%}
    {{ value }}
  {%- endif -%}
{%- endmacro %}

{% macro format_hcp(value) -%}
  {%- if value in (None, "", 0, 0.0) -%}
    —
  {%- elif value == 0.5 -%}
    ½
  {%- else -%}
    {{ value }}
  {%- endif -%}
{%- endmacro %}

{% macro last_name(value) -%}
  {%- if value -%}
    {{ value.split()[-1] }}
  {%- else -%}
    —
  {%- endif -%}
{%- endmacro %}

{% set card_data = scorecard or {} %}
{% set match_info = card_data.match or {} %}
{% set pair_cards = card_data.pair_cards or [] %}

{% block content %}
  <style>
    .kiosk-scorecard-data-shell {
      width: 100%;
      padding: 32px;
      border-radius: 32px;
      background: rgba(255, 255, 255, 0.95);
      box-shadow: 0 25px 55px rgba(0, 0, 0, 0.25);
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    .kiosk-scorecard-data-shell header {
      display: flex;
      flex-direction: column;
      gap: 8px;
      text-transform: uppercase;
      letter-spacing: 0.35em;
    }
    .kiosk-scorecard-data-shell h1 {
      margin: 0;
      font-size: clamp(2rem, 3vw, 2.8rem);
      letter-spacing: 0.25em;
    }
    .kiosk-scorecard-meta {
      display: flex;
      gap: 18px;
      font-size: 0.95rem;
      color: rgba(15, 23, 42, 0.75);
    }
    .kiosk-scorecard-pair-list {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }
    .kiosk-scorecard-card {
      padding: 24px;
      border-radius: 30px;
      background: linear-gradient(180deg, #181a23, #232636);
      color: #f4f4fb;
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.12);
    }
    .kiosk-scorecard-card-header {
      display: flex;
      flex-direction: column;
      gap: 6px;
      text-transform: uppercase;
      letter-spacing: 0.35em;
      margin-bottom: 18px;
    }
    .kiosk-scorecard-card-header h2 {
      margin: 0;
      font-size: 1.15rem;
      letter-spacing: 0.25em;
      color: #f6f7ff;
    }
    .kiosk-scorecard-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95rem;
    }
    .kiosk-scorecard-table th,
    .kiosk-scorecard-table td {
      padding: 6px 8px;
      text-align: center;
      border: none;
      letter-spacing: 0.1em;
    }
    .kiosk-scorecard-table thead th {
      font-size: 0.7rem;
      letter-spacing: 0.4em;
      color: rgba(255, 255, 255, 0.8);
    }
    .kiosk-scorecard-table tbody th {
      text-align: left;
      font-size: 0.75rem;
      letter-spacing: 0.35em;
      color: rgba(255, 255, 255, 0.7);
    }
    .kiosk-scorecard-table td {
      font-feature-settings: "tnum";
    }
    .kiosk-scorecard-total {
      font-weight: 600;
      letter-spacing: 0.25em;
      text-transform: uppercase;
      color: #fff;
    }
    .kiosk-scorecard-empty {
      margin: 0;
      text-align: center;
      letter-spacing: 0.5em;
      color: rgba(15, 23, 42, 0.75);
    }
    @media (max-width: 1024px) {
      .kiosk-scorecard-table thead,
      .kiosk-scorecard-table tbody {
        display: block;
      }
      .kiosk-scorecard-table th,
      .kiosk-scorecard-table td {
        display: inline-block;
        min-width: 45px;
      }
    }
  </style>

  <section class="kiosk-scorecard-data-shell">
    <header>
      <p class="muted-label">Scorecard</p>
      <h1>Match {{ match_info.match_key or "—" }}</h1>
      <div class="kiosk-scorecard-meta">
        <span>{{ match_info.division or "Division —" }}</span>
        <span>Status: {{ match_info.status_label or match_info.status or "—" }}</span>
        <span>{{ match_info.holes_recorded or 0 }} / {{ match_info.total_holes or 18 }} holes</span>
      </div>
    </header>

    {% if pair_cards %}
      <div class="kiosk-scorecard-pair-list">
        {% for card in pair_cards[:2] %}
          {% set holes = card.rows or [] %}
          <article class="kiosk-scorecard-card">
            <div class="kiosk-scorecard-card-header">
              <div>Card {{ loop.index }}</div>
              <h2>{{ card.players[0].name }} vs {{ card.players[1].name }}</h2>
            </div>
            <div class="kiosk-scorecard-table-wrapper">
              <table class="kiosk-scorecard-table">
                <thead>
                  <tr>
                    <th>Hole</th>
                    {% for hole in holes %}
                      <th>{{ hole.hole_number }}</th>
                    {% endfor %}
                    <th>Totals</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th>HCP</th>
                    {% for hole in holes %}
                      <td>{{ format_hcp(hole.handicap) }}</td>
                    {% endfor %}
                    <td class="kiosk-scorecard-total"></td>
                  </tr>
                  {% if card.strokes_present[0] %}
                    <tr>
                      <th>HCP {{ last_name(card.players[0].name) }}</th>
                      {% for hole in holes %}
                        <td>{{ format_hcp(hole.strokes_a) }}</td>
                      {% endfor %}
                      <td class="kiosk-scorecard-total">{{ format_hcp(card.meta.strokes_a) }}</td>
                    </tr>
                  {% endif %}
                  {% if card.strokes_present[1] %}
                    <tr>
                      <th>HCP {{ last_name(card.players[1].name) }}</th>
                      {% for hole in holes %}
                        <td>{{ format_hcp(hole.strokes_b) }}</td>
                      {% endfor %}
                      <td class="kiosk-scorecard-total">{{ format_hcp(card.meta.strokes_b) }}</td>
                    </tr>
                  {% endif %}
                  <tr>
                    <th>{{ last_name(card.players[0].name) }}</th>
                    {% for hole in holes %}
                      <td>{{ format_net(hole.net_a) }}</td>
                    {% endfor %}
                    <td class="kiosk-scorecard-total">{{ format_net(card.totals.net[0]) }}</td>
                  </tr>
                  <tr>
                    <th>{{ last_name(card.players[1].name) }}</th>
                    {% for hole in holes %}
                      <td>{{ format_net(hole.net_b) }}</td>
                    {% endfor %}
                    <td class="kiosk-scorecard-total">{{ format_net(card.totals.net[1]) }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <p class="kiosk-scorecard-empty">Waiting on match data…</p>
    {% endif %}
  </section>
{% endblock %}
