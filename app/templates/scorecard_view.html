{% extends "base.html" %}
{% block content %}
  {% set front_holes = scorecard.holes[:9] %}
  {% set back_holes = scorecard.holes[9:] %}
    <section class="card detail-card scorecard-panel">
      <div class="scorecard-layout">
        <div class="scorecard-info">
          <div class="match-meta">
            <p class="eyebrow">Match Scorecard</p>
            <h1 class="match-title">{{ scorecard.match.match_name }}</h1>
            <p class="match-sub">
              {{ scorecard.match.player_a_name }} (hcp {{ scorecard.player_a_handicap }})
              vs
              {{ scorecard.match.player_b_name }} (hcp {{ scorecard.player_b_handicap }})
            </p>
            {% if scorecard.course %}
              <p class="match-subtle course-meta">
                {{ scorecard.course.club_name }} — {{ scorecard.course.course_name }}
                {% if scorecard.course.tee_name %}
                  | Tee: {{ scorecard.course.tee_name }}
                {% endif %}
                {% if scorecard.course.total_yards %}
                  | {{ scorecard.course.total_yards }} yds
                {% endif %}
                {% if scorecard.course.course_rating %}
                  | CR {{ scorecard.course.course_rating }} / SR {{ scorecard.course.slope_rating or "—" }}
                {% endif %}
              </p>
            {% endif %}
          </div>

          <form class="scorecard-selector" method="get" action="/scorecard">
            <label>
              <span class="muted-label">Select match</span>
              <select name="match_key" onchange="this.form.submit()">
                {% for match_option in matches %}
                  <option value="{{ match_option.match_id }}" {% if match_option.match_id == active_match_key %}selected{% endif %}>
                    Division {{ match_option.division }}: {{ match_option.player_a }} vs {{ match_option.player_b }}
                  </option>
                {% endfor %}
              </select>
            </label>
          </form>

          <div class="scorecard-summary-grid">
            <div class="scorecard-summary-block">
              <span class="muted-label">Stroke allocation</span>
              <p class="match-subtle">
                {% if scorecard.meta.stroke_owner %}
                  {{ scorecard.match.player_a_name if scorecard.meta.stroke_owner == 'A' else scorecard.match.player_b_name }}
                  receives
                  {{ scorecard.meta.stroke_count if scorecard.meta.stroke_count % 1 else scorecard.meta.stroke_count|int }} stroke{{ 's' if scorecard.meta.stroke_count != 1 else '' }}
                  {% if scorecard.meta.is_nine_hole %}(9-hole allowance applied){% endif %}
                {% else %}
                  No strokes allocated for this matchup.
                {% endif %}
              </p>
            </div>
            <div class="scorecard-points">
              <div>
                <span>{{ scorecard.match.player_a_name }} pts</span>
                <strong>{{ scorecard.meta.total_points_a|round(1) }}</strong>
              </div>
              <div>
                <span>{{ scorecard.match.player_b_name }} pts</span>
                <strong>{{ scorecard.meta.total_points_b|round(1) }}</strong>
              </div>
            </div>
          </div>

          <div class="scorecard-actions">
            {% if scorecard.match.id %}
              <a class="pill-link" href="/matches/{{ scorecard.match.id }}">Edit hole inputs</a>
            {% else %}
              <a class="pill-link" href="/scoring">Enter scores</a>
            {% endif %}
          </div>
        </div>

      <div class="scorecard-column">
        <h3 class="scorecard-column-title">Holes 1-9</h3>
        <section class="match-scorecard-table" aria-label="Front nine scorecard">
          <div class="match-scorecard-row match-scorecard-head">
            <span>Hole</span>
            <span>Par</span>
            <span>HCP</span>
            <span><abbr title="{{ scorecard.match.player_a_name }} Gross">A Gross</abbr></span>
            <span><abbr title="{{ scorecard.match.player_b_name }} Gross">B Gross</abbr></span>
            <span><abbr title="{{ scorecard.match.player_a_name }} Net">A Net</abbr></span>
            <span><abbr title="{{ scorecard.match.player_b_name }} Net">B Net</abbr></span>
            <span>Net Diff</span>
            <span>{{ scorecard.match.player_a_name }} Pts</span>
            <span>{{ scorecard.match.player_b_name }} Pts</span>
          </div>
          {% for hole in front_holes %}
            <div class="match-scorecard-row">
              <span>{{ hole.hole_number }}</span>
              <span>{{ hole.par }}</span>
              <span>{{ hole.handicap }}</span>
              <span>{{ hole.gross_a if hole.gross_a is not none else "—" }}</span>
              <span>{{ hole.gross_b if hole.gross_b is not none else "—" }}</span>
              <span>
                {% if hole.net_a is none %}
                  —
                {% elif hole.net_a % 1 %}
                  {{ hole.net_a|round(1) }}
                {% else %}
                  {{ hole.net_a|int }}
                {% endif %}
              </span>
              <span>
                {% if hole.net_b is none %}
                  —
                {% elif hole.net_b % 1 %}
                  {{ hole.net_b|round(1) }}
                {% else %}
                  {{ hole.net_b|int }}
                {% endif %}
              </span>
              <span>
                {% if hole.net_diff is none %}
                  —
                {% else %}
                  {{ hole.net_diff|round(1) if hole.net_diff % 1 else hole.net_diff|int }}
                {% endif %}
              </span>
              <span>{{ hole.points_a if hole.points_a % 1 else hole.points_a|int }}</span>
              <span>{{ hole.points_b if hole.points_b % 1 else hole.points_b|int }}</span>
            </div>
          {% endfor %}
        </section>
      </div>

      <div class="scorecard-column">
        <h3 class="scorecard-column-title">Holes 10-18</h3>
        <section class="match-scorecard-table" aria-label="Back nine scorecard">
          <div class="match-scorecard-row match-scorecard-head">
            <span>Hole</span>
            <span>Par</span>
            <span>HCP</span>
            <span><abbr title="{{ scorecard.match.player_a_name }} Gross">A Gross</abbr></span>
            <span><abbr title="{{ scorecard.match.player_b_name }} Gross">B Gross</abbr></span>
            <span><abbr title="{{ scorecard.match.player_a_name }} Net">A Net</abbr></span>
            <span><abbr title="{{ scorecard.match.player_b_name }} Net">B Net</abbr></span>
            <span>Net Diff</span>
            <span>{{ scorecard.match.player_a_name }} Pts</span>
            <span>{{ scorecard.match.player_b_name }} Pts</span>
          </div>
          {% for hole in back_holes %}
            <div class="match-scorecard-row">
              <span>{{ hole.hole_number }}</span>
              <span>{{ hole.par }}</span>
              <span>{{ hole.handicap }}</span>
              <span>{{ hole.gross_a if hole.gross_a is not none else "—" }}</span>
              <span>{{ hole.gross_b if hole.gross_b is not none else "—" }}</span>
              <span>
                {% if hole.net_a is none %}
                  —
                {% elif hole.net_a % 1 %}
                  {{ hole.net_a|round(1) }}
                {% else %}
                  {{ hole.net_a|int }}
                {% endif %}
              </span>
              <span>
                {% if hole.net_b is none %}
                  —
                {% elif hole.net_b % 1 %}
                  {{ hole.net_b|round(1) }}
                {% else %}
                  {{ hole.net_b|int }}
                {% endif %}
              </span>
              <span>
                {% if hole.net_diff is none %}
                  —
                {% else %}
                  {{ hole.net_diff|round(1) if hole.net_diff % 1 else hole.net_diff|int }}
                {% endif %}
              </span>
              <span>{{ hole.points_a if hole.points_a % 1 else hole.points_a|int }}</span>
              <span>{{ hole.points_b if hole.points_b % 1 else hole.points_b|int }}</span>
            </div>
          {% endfor %}
        </section>
      </div>
    </div>
  </section>
{% endblock %}
